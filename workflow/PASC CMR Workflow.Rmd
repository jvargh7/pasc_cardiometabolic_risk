---
title: "Data Management Workflow"
author: "Varghese, Jithin Sam"
date: "`r Sys.Date()`"
output: 
  slidy_presentation:
    toc: true
    toc_float: true

---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE,results = TRUE)
```

# Introduction
This code and data management workflow is intended to be used along with the secure shared folder that contains Raw data.   

Analytic code: [https::/github.com/jvargh7/pasc_cardiometabolic_risk](https::/github.com/jvargh7/pasc_cardiometabolic_risk)   

## Folder Structure

- **source**: Proposals/R01S COVID x Post Acute Diabetes Diagnosis/working/raw
    - demo_other_\<version\>
        - address_history_\<version\>.csv
        - condition_\<version\>.csv
        - death_\<version\>.csv
        - demographic_\<version\>.csv
        - dispensing_\<version\>.csv
        - encounter_\<version\>.csv
        - enrollment_\<version\>.csv
        - pros_\<version\>.csv
        - provider_\<version\>.csv
    - diagnosis_\<version\>
        - diagnosis_\<version\>.csv
    - lab_\<version\>
        - lab_\<version\>.csv
    - med_admin_\<version\>
        - med_admin_\<version\>.csv
    - obsclin_\<version\>
        - obsclin_\<version\>.csv
    - prescribing_\<version\>
        - prescribing_\<version\>.csv
    - px_vital_\<version\>
        - procedures_\<version\>.csv
        - vital_\<version\>.csv

- **repo**: pasc_cardiometabolic_risk
    - data
    - workflow
    - preprocessing
    - analysis
    - functions
    - paper

- **shared**: Papers/PASC Cardiometabolic Risk 
    - working
        - raw
        - cleaned
        - dictionaries
    - writing
    - references
    - figures


## Workflow

The workflow can be divided into **3 steps**, with the final output being tables and figures for the manuscript. The current presentation is generated separately for each of the steps in a vertical scroll. You can navigate between the steps using the 'Contents' option on the bottom left or by clicking the alphabet **C** on your keyboard.  

- PREPROCESSING: *Reading data, cleaning variables*  
- ANALYSIS: *Descriptive and inferential statistics*  
- PAPER: *Figures and Tables for manuscript*  

# PREPROCESSING

## Flowchart
This step can be divided into sub-components

```{r}
DiagrammeR::grViz("digraph {
  graph [layout = dot, rankdir = TB]
  
  node [shape = rectangle]        
  rec1 [label = 'Step 1. Read and clean separately']
  rec2 [label = 'Step 2. Merge linked datasets']
  rec3 [label =  'Step 3. Clean merged datasets']
  rec4 [label = 'Step 4. Create analytic dataset']
  
  # edge definitions with the node IDs
  rec1 -> rec2 -> rec3 -> rec4
  }",
  height = 300)
```

## Step 1. Read and clean separately
The raw data consists of 15 datasets. Majority of datasets are in a **long** format to reflect the longitudinal nature of the data.   

Datasets in **long** format (*\<dataset_name\>_\<version\>*): 
- **address_history**: longitudinal limited data series of addresses  
- **condition**: diagnosed and self-reported health conditions/diseases  
- **diagnosis**: diagnosis codes from healthcare-mediated processes and reimbursement drivers    
- **dispensing**: prescriptions filled (community, mail-order, hospital pharmacy but not OP dispensing)  
- **encounter**: interactions between patients and providers  
- **enrollment**: periods of time when expected to have complete data capture  
- **lab**: blood and body speciments measurement  
    + lab_RAW: Raw values
    + lab_RESULT: Harmonized values
- **med_admin**: medications administered by providers in any (IP, OP, home health) setting  
- **obs_clin**: clinical observations  
- **prescribing**: provider orders for medication dispensing/administration  
- **pros**: patient-reported outcome measures or questionnaires  
- **procedures**: procedure codes for discrete medical interventions and diagnostic testing  
- **provider**: providers involved in care processes  
- **vital**: vital signs  

**Cross-sectional** datasets:

- **death**: mortality information
- **demographic**: direct attributes of individual patient

### Data cleaning files

This sub-step in the **PREPROCESSING** workflow consists of 2 analytic files.

- repo/data/pcrd02_saving data from csv to RDS.R: *All files in .csv format would be read from the source folder and saved --\> shared/working/raw/\<filename\>.RDS*
- repo/preprocessing/pcrpre01_cleaning raw data.R: *All files in .RDS format would be cleaned and deposited into a shared/working/cleaned/\<filename\>.RDS folder*
    + Each dataset has its own cleaning file of the format pcrpre_\<dataset_name\>.R
    + Cleaning would be specific to pasc_cardiometabolic_risk paper's requirements
        - longitudinal dataset of cardiometabolic trajectories
        - baseline confounding adjustment
        - loss to follow-up or death
    + Cleaning for pasc_diabetes paper would be done separately

# ANALYSIS


# PAPER